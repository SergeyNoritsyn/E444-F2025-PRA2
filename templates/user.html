{% extends "bootstrap/base.html" %}

{% block title %}Flasky{% endblock %}

{% block navbar %}
<div class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle"
             data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Flasky</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="/">Home</a></li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Hello, {{ name }}!</h1>
    </div>
    <div class="text">
        <p>The local date and time is {{ now }}.</p>
        <p id="timeago"></p>

        <script>
            // Get the timestamp Flask passed in (seconds since epoch)
            const pastTime = new Date("{{ timestamp|tojson }}" * 1000);

            function updateTimeAgo() {
                const now = new Date();
                let diff = Math.floor((now - pastTime) / 1000); // in seconds

                let text;
                if (diff < 60) {
                    text = `${diff} second${diff !== 1 ? 's' : ''} ago`;
                } else if (diff < 3600) {
                    const minutes = Math.floor(diff / 60);
                    text = `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
                } else if (diff < 86400) {
                    const hours = Math.floor(diff / 3600);
                    text = `${hours} hour${hours !== 1 ? 's' : ''} ago`;
                } else {
                    const days = Math.floor(diff / 86400);
                    text = `${days} day${days !== 1 ? 's' : ''} ago`;
                }

                document.getElementById("timeago").textContent =
                    `That was ${text}`;
            }

            // Update immediately and then every second
            updateTimeAgo();
            setInterval(updateTimeAgo, 1000);
        </script>
    </div>
</div>
{% endblock %}
